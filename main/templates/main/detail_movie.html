{% extends 'base.html' %}

{% block content %}

<div class="detail">
    <h3> {{ blog.writer }} </h3> 
    <h2>날짜 : {{blog.pub_date}}</h2> <br>
    <h1>{{blog.title}}</h1>
    <h2>장르 : {{blog.genre}}</h2>
    <h2>평점:{{blog.test_list}}</h2>
    <h2>한줄평 : {{blog.summary}}</h2>
 
    {% if blog.image %}
        <div class="photo"><img src="{{ blog.image.url }}" alt="사진" width="200" height="300"> </div>
    {% endif %}    
    <p>{{blog.body|linebreaksbr}}</p>
    <button style="background-color:#336491; border: #336491; color:white; width: 80px;height: 40px;font-size:15px;position:relative;top:50px;" >
        <a href="{%url 'main:edit' blog.id%}" style="text-decoration: none;color:white;">수정하기</a></button>
    <button style="background-color:#336491; border: #336491; color:white; width: 80px;height: 40px;font-size:15px;position:relative;top:50px; left:5px;">
        <a href="{%url 'main:delete' blog.id%}" style="text-decoration: none;color:white;">삭제하기</a></button>
        <h1><br><br></h1>

        <span href="#" class="like" name ="{{blog.id}}" value="Like">
            {% if user in blog.like_user_set.all %}
                <div class="alt-service-icon">
                    <i class="fa-solid fa-thumbs-up" id ="like-icon" style="color:red;"></i>
                </div>
            {% else %}
                <div class="alt-service-icon">
                    <i class="fa-solid fa-thumbs-up" id ="like-icon" style="color:black;"></i>
                </div>
            {% endif %}
                <span id="count-{{ blog.id }}" class="alt-services-title font-alt">
                    좋아요
                {% if blog.like_count == 0 %}
                    0개
                {% else %}
                    {{ blog.like_count }}개
                 {% endif %}
                </span> 
         </span>
         <span href="#" class="dislike" name ="{{blog.id}}" value="Dislike" >
            {% if user in blog.dislike_user_set.all %}
                <div class="alt-service-icon">
                    <i class="fa-solid fa-thumbs-down" id ="dislike-icon" style="color:blue;"></i>
                </div>
            {% else %}
                <div class="alt-service-icon">
                    <i class="fa-solid fa-thumbs-down" id ="dislike-icon" style="color:black;"></i>
                </div>
            {% endif %}
                <span id="count2-{{ blog.id }}" class="alt-services-title font-alt">
                    &nbsp;싫어요
                {% if blog.dislike_count == 0 %}
                    0개
                {% else %}
                    {{ blog.dislike_count }}개
                 {% endif %}
                </span>
         </span>

<div class="comment">
   <div>
     <form action="{%url 'main:create_comment' blog.id%}" method="POST">
      {%csrf_token%}
      <textarea name="content" placeholder="댓글내용입력" style="width:800px;height:90px;border: 2px solid #000000;" ></textarea>
      <input type="submit" value="확인" style="background-color:#336491; border: #336491; color:white; width: 80px;height: 40px;font-size:15px; position:relative; left:30px; top:-10px">
     </form>
    </div>

    <div>
    {% for comment in comments %}
    <div>
    {{comment.writer}}
    <br>
    {{comment.content}}
    <br><hr>
    </div>
    {% endfor %}
    </div>

</div>
</div>

<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script>
    $(".like").click(function(){
        var pk=$(this).attr('name')
        $.ajax({
             type:'POST',
            url:"{% url 'main:like_toggle' blog.pk %}",
            data:{'pk':pk,'csrfmiddlewaretoken':'{{csrf_token}}'},
            dataType:'json',
            success:function(response){
                if(response.like_count==null){
                    alert('로그인이 필요합니다.');
                     window.location.replace('/accounts/login/');
                }
                else{
                    if(response.result=='like'){
                       $('#like-icon').removeClass();
                        $('#like-icon').addClass('fa-solid fa-thumbs-up');
                    }
                    else{
                         $('#like-icon').removeClass();
                        $('#like-icon').addClass('fa-solid fa-thumbs-up');
                     }
                    $('#count-{{blog.id}}').html('좋아요'+response.like_count+"개");
                 }
            },
             error:function(request, status, error){
                alert("로그인이 필요합니다.")
                alert('code:'+request.status+'\n'+'message:'+request.responseText+"\n"+"error:"+error);
            },
         })
    })
</script>
<script>
    $(".dislike").click(function(){
        var pk=$(this).attr('name')
        $.ajax({
             type:'POST',
            url:"{% url 'main:dislike_toggle' blog.pk %}",
            data:{'pk':pk,'csrfmiddlewaretoken':'{{csrf_token}}'},
            dataType:'json',
            success:function(response){
                if(response.dislike_count==null){
                    alert('로그인이 필요합니다.');
                     window.location.replace('/accounts/login/');
                }
                else{
                    if(response.result=='dislike'){
                       $('#dislike-icon').removeClass();
                        $('#dislike-icon').addClass('fa-solid fa-thumbs-down');
                    }
                    else{
                         $('#dislike-icon').removeClass();
                        $('#dislike-icon').addClass('fa-solid fa-thumbs-down');
                     }
                    $('#count2-{{blog.id}}').html('싫어요'+response.dislike_count+"개");
                 }
            },
             error:function(request, status, error){
                alert("로그인이 필요합니다.")
                alert('code:'+request.status+'\n'+'message:'+request.responseText+"\n"+"error:"+error);
            },
         })
    })
</script>

{% endblock %}   